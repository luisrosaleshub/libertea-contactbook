@page "/customersearch"
@inject IHttpClientFactory ClientFactory

<h3>Customer Search</h3>

<div class="mb-3">
    <input class="form-control" @bind-value="search" @bind-value:event="oninput" @onkeypress="HandleKeyPress" placeholder="Search by name..." />
    <button class="btn btn-primary mt-2" @onclick="SearchCustomers">Search</button>
</div>

@if (isLoading)
{
    <p>Loading...</p>
}
else if (customers is not null)
{
    <ul class="list-group">
        @foreach (var c in customers)
        {
            <li class="list-group-item">
                <a href="@($"/customerdetail/{c.Id}")">
                    @c.FirstName @c.LastName
                </a>
            </li>
        }
    </ul>
}

@code {
    private string search = "";
    private List<Customer>? customers;
    private bool isLoading = false;

    private async Task HandleKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await SearchCustomers();
        }
    }

    private async Task SearchCustomers()
    {
        isLoading = true;
        customers = null;

        var client = ClientFactory.CreateClient("LiberTeaAPI");
        customers = await client.GetFromJsonAsync<List<Customer>>($"/api/customers?search={search}");

        isLoading = false;
    }
}
